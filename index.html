<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostHog Advanced Features Demo</title>
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KVJM4S67');</script>
    <!-- End Google Tag Manager -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        .feature-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 10px 5px;
        }

        .analytics-info {
            background: rgba(52, 152, 219, 0.1);
            border: 2px solid rgba(52, 152, 219, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .analytics-info h3 {
            color: #3498db;
            margin-bottom: 10px;
        }

        .analytics-info ul {
            margin-left: 20px;
            color: #666;
        }

        .analytics-info li {
            margin-bottom: 5px;
        }

        .demo-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .demo-section h2 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #333;
        }

        .demo-section .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            min-width: 150px;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .feature-flag-demo {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .feature-flag-demo h3 {
            color: #f57c00;
            margin-bottom: 15px;
        }

        .experiment-variant {
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid #4caf50;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .experiment-variant h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .error-demo {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid #f44336;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .error-demo h3 {
            color: #c62828;
            margin-bottom: 15px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info-box p {
            margin: 5px 0;
            color: #1565c0;
        }

        .code-snippet {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 15px 0;
            overflow-x: auto;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background: #4caf50;
            box-shadow: 0 0 10px #4caf50;
        }

        .status-inactive {
            background: #9e9e9e;
        }

        #featureFlagContent {
            display: none;
        }

        #experimentVariant {
            text-align: center;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .demo-section {
                padding: 20px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KVJM4S67"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container">
        <header class="header">
            <h1>ü¶î PostHog Advanced Features</h1>
            <p>Learn Feature Flags, A/B Testing, and Error Tracking hands-on!</p>
            <div>
                <span class="feature-badge">üö© Feature Flags</span>
                <span class="feature-badge">üß™ Experiments</span>
                <span class="feature-badge">üêõ Error Tracking</span>
            </div>
        </header>

        <div class="analytics-info">
            <h3>üéì What You'll Learn:</h3>
            <ul>
                <li><strong>Feature Flags:</strong> Control features without deploying code</li>
                <li><strong>A/B Testing:</strong> Test different variations to optimize conversions</li>
                <li><strong>Error Tracking:</strong> Capture and monitor JavaScript errors</li>
                <li><strong>User Properties:</strong> Segment users and target specific groups</li>
                <li><strong>Event Tracking:</strong> Measure success metrics for experiments</li>
            </ul>
        </div>

        <!-- Feature Flags Section -->
        <section class="demo-section">
            <h2>üö© Feature Flags Demo</h2>
            <p class="subtitle">Control feature visibility without code deployments</p>
            
            <div class="feature-flag-demo">
                <h3>
                    <span class="status-indicator" id="flagStatus"></span>
                    Premium Feature Flag Status
                </h3>
                <div class="info-box">
                    <p><strong>Flag Key:</strong> <code>show-premium-features</code></p>
                    <p><strong>Current Status:</strong> <span id="flagValue">Checking...</span></p>
                    <p><strong>What it does:</strong> Shows/hides premium content below</p>
                </div>
                
                <div id="featureFlagContent" style="margin-top: 20px;">
                    <div style="background: linear-gradient(135deg, #ffd700, #ffed4e); padding: 25px; border-radius: 15px; text-align: center;">
                        <h3 style="margin: 0 0 10px 0;">üåü Premium Feature Unlocked!</h3>
                        <p style="margin: 0; color: #333;">This content is only visible when the feature flag is enabled in PostHog.</p>
                        <button class="btn btn-primary" onclick="trackFeatureFlagInteraction()" style="margin-top: 15px;">
                            Use Premium Feature
                        </button>
                    </div>
                </div>

                <div class="code-snippet">
// PostHog Feature Flag Check
if (posthog.isFeatureEnabled('show-premium-features')) {
    // Show premium content
    document.getElementById('featureFlagContent').style.display = 'block';
}</div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="checkFeatureFlag()">
                    üîÑ Refresh Flag Status
                </button>
                <button class="btn btn-secondary" onclick="identifyUser()">
                    üë§ Identify as Premium User
                </button>
            </div>
        </section>

        <!-- A/B Testing / Experiments Section -->
        <section class="demo-section">
            <h2>üß™ A/B Testing Experiment</h2>
            <p class="subtitle">Test different button variations to see which performs better</p>
            
            <div class="experiment-variant">
                <h3>Experiment: CTA Button Test</h3>
                <div class="info-box">
                    <p><strong>Experiment Key:</strong> <code>cta-button-test</code></p>
                    <p><strong>Your Variant:</strong> <span id="experimentVariant">Loading...</span></p>
                    <p><strong>Hypothesis:</strong> Does "Get Started Free" convert better than "Try Now"?</p>
                </div>

                <div id="experimentContent" style="margin-top: 25px; text-align: center;">
                    <!-- Variant will be loaded here by JavaScript -->
                </div>

                <div class="code-snippet">
// PostHog A/B Testing
const variant = posthog.getFeatureFlag('cta-button-test');
if (variant === 'control') {
    showButton('Try Now', 'primary');
} else if (variant === 'test') {
    showButton('Get Started Free', 'success');
}</div>
            </div>

            <div class="info-box">
                <p><strong>üí° Tip:</strong> PostHog will automatically split users into control/test groups and track conversion rates for each variant.</p>
            </div>
        </section>

        <!-- Error Tracking Section -->
        <section class="demo-section">
            <h2>üêõ Error Tracking Demo</h2>
            <p class="subtitle">See how PostHog captures and reports JavaScript errors</p>
            
            <div class="error-demo">
                <h3>Trigger Different Error Types</h3>
                <div class="info-box">
                    <p><strong>What happens:</strong> These buttons intentionally cause errors that PostHog will capture</p>
                    <p><strong>Check PostHog:</strong> Go to "Errors" or "Session Recordings" to see the captured errors</p>
                </div>

                <div class="button-group">
                    <button class="btn btn-danger" onclick="triggerReferenceError()">
                        üí• Reference Error
                    </button>
                    <button class="btn btn-danger" onclick="triggerTypeError()">
                        üí• Type Error
                    </button>
                    <button class="btn btn-danger" onclick="triggerCustomError()">
                        üí• Custom Error
                    </button>
                    <button class="btn btn-warning" onclick="triggerNetworkError()">
                        üåê Network Error Simulation
                    </button>
                </div>

                <div class="code-snippet">
// PostHog automatically captures errors
try {
    nonExistentFunction(); // This will be captured
} catch (error) {
    posthog.capture('$exception', {
        error: error.message,
        stack: error.stack
    });
}</div>
            </div>
        </section>

        <!-- User Identification Section -->
        <section class="demo-section">
            <h2>üë§ User Identification & Properties</h2>
            <p class="subtitle">Test user segmentation and targeting</p>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="identifyUser()">
                    Identify as Premium User
                </button>
                <button class="btn btn-secondary" onclick="identifyBasicUser()">
                    Identify as Basic User
                </button>
                <button class="btn btn-success" onclick="setUserProperties()">
                    Set Custom Properties
                </button>
                <button class="btn btn-warning" onclick="resetUser()">
                    Reset User Identity
                </button>
            </div>

            <div class="info-box">
                <p><strong>Current User ID:</strong> <span id="currentUserId">Anonymous</span></p>
                <p><strong>User Type:</strong> <span id="userType">Not set</span></p>
            </div>

            <div class="code-snippet">
// Identify user with properties
posthog.identify('user_123', {
    email: 'user@example.com',
    plan: 'premium',
    signup_date: '2024-01-15'
});</div>
        </section>

        <!-- Event Tracking Section -->
        <section class="demo-section">
            <h2>üìä Custom Event Tracking</h2>
            <p class="subtitle">Track custom events for funnel analysis</p>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="trackCustomEvent('demo_started', {source: 'feature_flags'})">
                    Track Demo Started
                </button>
                <button class="btn btn-secondary" onclick="trackCustomEvent('feature_tested', {feature: 'premium'})">
                    Track Feature Test
                </button>
                <button class="btn btn-success" onclick="trackCustomEvent('conversion', {value: 99})">
                    Track Conversion
                </button>
            </div>

            <div class="code-snippet">
// Track custom events
posthog.capture('conversion', {
    value: 99,
    currency: 'USD',
    source: 'experiment'
});</div>
        </section>
    </div>

    <script>
        // Initialize dataLayer for GTM
        window.dataLayer = window.dataLayer || [];
        
        // Wait for PostHog to load
        let posthogReady = false;
        let userIdentified = false;

        // Check if PostHog is available
        function waitForPostHog() {
            if (typeof posthog !== 'undefined') {
                posthogReady = true;
                console.log('‚úÖ PostHog is ready!');
                initializeFeatures();
            } else {
                console.log('‚è≥ Waiting for PostHog...');
                setTimeout(waitForPostHog, 500);
            }
        }

        // Initialize all features
        function initializeFeatures() {
            checkFeatureFlag();
            loadExperimentVariant();
            updateUserDisplay();
        }

        // Feature Flag Functions
        function checkFeatureFlag() {
            if (!posthogReady) {
                showNotification('‚è≥ PostHog is still loading...', 'warning');
                return;
            }

            const flagEnabled = posthog.isFeatureEnabled('show-premium-features');
            const statusIndicator = document.getElementById('flagStatus');
            const flagValue = document.getElementById('flagValue');
            const flagContent = document.getElementById('featureFlagContent');

            if (flagEnabled) {
                flagValue.textContent = '‚úÖ Enabled';
                statusIndicator.className = 'status-indicator status-active';
                flagContent.style.display = 'block';
                
                posthog.capture('feature_flag_checked', {
                    flag_name: 'show-premium-features',
                    flag_value: true
                });
            } else {
                flagValue.textContent = '‚ùå Disabled';
                statusIndicator.className = 'status-indicator status-inactive';
                flagContent.style.display = 'none';
                
                posthog.capture('feature_flag_checked', {
                    flag_name: 'show-premium-features',
                    flag_value: false
                });
            }

            showNotification(`Feature flag is ${flagEnabled ? 'enabled' : 'disabled'}`);
        }

        function trackFeatureFlagInteraction() {
            posthog.capture('premium_feature_used', {
                feature: 'premium_content',
                timestamp: new Date().toISOString()
            });
            
            window.dataLayer.push({
                'event': 'premium_feature_interaction',
                'feature_name': 'premium_content'
            });

            showNotification('‚úÖ Premium feature interaction tracked!');
        }

        // A/B Testing Functions
        function loadExperimentVariant() {
            if (!posthogReady) return;

            const variant = posthog.getFeatureFlag('cta-button-test');
            const experimentVariant = document.getElementById('experimentVariant');
            const experimentContent = document.getElementById('experimentContent');

            if (variant === 'control') {
                experimentVariant.textContent = 'üÖ∞Ô∏è Control (Original)';
                experimentContent.innerHTML = `
                    <button class="btn btn-primary" onclick="trackExperimentClick('control')" style="font-size: 1.2rem; padding: 20px 40px;">
                        Try Now
                    </button>
                `;
            } else if (variant === 'test') {
                experimentVariant.textContent = 'üÖ±Ô∏è Test (Variation)';
                experimentContent.innerHTML = `
                    <button class="btn btn-success" onclick="trackExperimentClick('test')" style="font-size: 1.2rem; padding: 20px 40px;">
                        Get Started Free
                    </button>
                `;
            } else {
                experimentVariant.textContent = '‚ö†Ô∏è Not in experiment';
                experimentContent.innerHTML = `
                    <p style="color: #666;">You're not currently enrolled in this experiment. Try identifying as a user first.</p>
                `;
            }

            posthog.capture('experiment_variant_loaded', {
                experiment: 'cta-button-test',
                variant: variant || 'none'
            });
        }

        function trackExperimentClick(variant) {
            posthog.capture('experiment_cta_clicked', {
                experiment: 'cta-button-test',
                variant: variant,
                timestamp: new Date().toISOString()
            });

            window.dataLayer.push({
                'event': 'experiment_conversion',
                'experiment_name': 'cta-button-test',
                'variant': variant
            });

            showNotification(`‚úÖ Clicked ${variant} variant - tracked in PostHog!`);
        }

        // Error Tracking Functions
        function triggerReferenceError() {
            try {
                nonExistentFunction();
            } catch (error) {
                posthog.capture('$exception', {
                    error_type: 'ReferenceError',
                    error_message: error.message,
                    error_stack: error.stack,
                    triggered_by: 'user_action'
                });
                showNotification('üí• Reference Error captured by PostHog!', 'error');
            }
        }

        function triggerTypeError() {
            try {
                const obj = null;
                obj.someMethod();
            } catch (error) {
                posthog.capture('$exception', {
                    error_type: 'TypeError',
                    error_message: error.message,
                    error_stack: error.stack,
                    triggered_by: 'user_action'
                });
                showNotification('üí• Type Error captured by PostHog!', 'error');
            }
        }

        function triggerCustomError() {
            const error = new Error('This is a custom error for testing');
            posthog.capture('$exception', {
                error_type: 'CustomError',
                error_message: error.message,
                error_stack: error.stack,
                triggered_by: 'user_action',
                severity: 'high'
            });
            showNotification('üí• Custom Error sent to PostHog!', 'error');
        }

        function triggerNetworkError() {
            posthog.capture('network_error_simulation', {
                error_type: 'NetworkError',
                endpoint: '/api/fake-endpoint',
                status_code: 500,
                message: 'Simulated server error'
            });
            showNotification('üåê Network Error simulation tracked!', 'warning');
        }

        // User Identification Functions
        function identifyUser() {
            if (!posthogReady) {
                showNotification('‚è≥ PostHog is still loading...', 'warning');
                return;
            }

            const userId = 'user_premium_' + Math.floor(Math.random() * 1000);
            posthog.identify(userId, {
                email: 'premium@example.com',
                plan: 'premium',
                signup_date: '2024-01-15',
                total_spent: 299.99,
                features_enabled: ['advanced_analytics', 'priority_support']
            });

            userIdentified = true;
            showNotification('‚úÖ Identified as Premium User!');
            updateUserDisplay();
            
            // Reload features with new user context
            setTimeout(() => {
                checkFeatureFlag();
                loadExperimentVariant();
            }, 500);
        }

        function identifyBasicUser() {
            if (!posthogReady) {
                showNotification('‚è≥ PostHog is still loading...', 'warning');
                return;
            }

            const userId = 'user_basic_' + Math.floor(Math.random() * 1000);
            posthog.identify(userId, {
                email: 'basic@example.com',
                plan: 'basic',
                signup_date: new Date().toISOString().split('T')[0],
                total_spent: 0
            });

            userIdentified = true;
            showNotification('‚úÖ Identified as Basic User!');
            updateUserDisplay();
            
            setTimeout(() => {
                checkFeatureFlag();
                loadExperimentVariant();
            }, 500);
        }

        function setUserProperties() {
            if (!posthogReady || !userIdentified) {
                showNotification('‚ö†Ô∏è Please identify as a user first!', 'warning');
                return;
            }

            posthog.setPersonProperties({
                custom_property: 'test_value',
                last_active: new Date().toISOString(),
                page_views: Math.floor(Math.random() * 100),
                favorite_feature: 'experiments'
            });

            showNotification('‚úÖ Custom properties set!');
        }

        function resetUser() {
            if (!posthogReady) return;
            
            posthog.reset();
            userIdentified = false;
            showNotification('üîÑ User identity reset!');
            updateUserDisplay();
            
            setTimeout(() => {
                checkFeatureFlag();
                loadExperimentVariant();
            }, 500);
        }

        function updateUserDisplay() {
            const userIdDisplay = document.getElementById('currentUserId');
            const userTypeDisplay = document.getElementById('userType');
            
            if (userIdentified && posthogReady) {
                const distinctId = posthog.get_distinct_id();
                userIdDisplay.textContent = distinctId;
                
                const props = posthog.getFeatureFlagPayload('show-premium-features');
                userTypeDisplay.textContent = distinctId.includes('premium') ? 'Premium' : 'Basic';
            } else {
                userIdDisplay.textContent = 'Anonymous';
                userTypeDisplay.textContent = 'Not set';
            }
        }

        // Custom Event Tracking
        function trackCustomEvent(eventName, properties = {}) {
            if (!posthogReady) {
                showNotification('‚è≥ PostHog is still loading...', 'warning');
                return;
            }

            posthog.capture(eventName, {
                ...properties,
                timestamp: new Date().toISOString(),
                page: window.location.pathname
            });

            window.dataLayer.push({
                'event': 'custom_posthog_event',
                'event_name': eventName,
                'event_properties': properties
            });

            showNotification(`‚úÖ Event tracked: ${eventName}`);
        }

        // Notification System
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const colors = {
                success: 'linear-gradient(135deg, #667eea, #764ba2)',
                error: 'linear-gradient(135deg, #ff6b6b, #ee5a6f)',
                warning: 'linear-gradient(135deg, #ffecd2, #fcb69f)'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.success};
                color: ${type === 'warning' ? '#333' : 'white'};
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                z-index: 1000;
                font-weight: 600;
                transform: translateX(400px);
                transition: transform 0.3s ease;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Page view tracking
        window.dataLayer.push({
            'event': 'page_view',
            'page_title': document.title,
            'page_location': window.location.href,
            'timestamp': new Date().toISOString()
        });

        // Initialize when page loads
        window.addEventListener('load', () => {
            waitForPostHog();
        });

        // Also try immediately in case PostHog loads quickly
        waitForPostHog();
    </script>
</body>
</html>
